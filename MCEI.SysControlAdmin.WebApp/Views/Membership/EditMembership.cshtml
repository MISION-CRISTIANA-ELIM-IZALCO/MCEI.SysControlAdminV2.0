@model MCEI.SysControlAdmin.EN.Membership___EN.Membership

@{
    ViewData["Title"] = "Modificar Membresia";
}

<link href="/css/Membership/DesignCreateAndEdit.css" rel="stylesheet" />

<br />
<h1>Formulario Modificar Membresia</h1>
<span>@ViewBag.Error</span>
<hr />
<br />
<div class="row">
    <div class="col-md-12">
        <form id="Form" asp-action="EditMembership" onsubmit="CreateRecord(event)" enctype="multipart/form-data">
            <div asp-validation-summary="ModelOnly" class="text-danger"></div>
            <input type="hidden" asp-for="Id" />
            <h3>Información Personal</h3>
            <div class="form-group-row">
                <div class="form-group">
                    <label asp-for="Name" class="control-label"></label>
                    <input asp-for="Name" class="form-control" placeholder="Ingresar" required />
                    <span asp-validation-for="Name" class="text-danger"></span>
                </div>
                <div class="form-group">
                    <label asp-for="LastName" class="control-label"></label>
                    <input asp-for="LastName" class="form-control" placeholder="Ingresar" required />
                    <span asp-validation-for="LastName" class="text-danger"></span>
                </div>
                <div class="form-group">
                    <label asp-for="Dui" class="control-label"></label>
                    <input asp-for="Dui" id="Dui" class="form-control" placeholder="00000000-0" />
                </div>
                <div class="form-group">
                    <label asp-for="DateOfBirth" class="control-label"></label>
                    <input asp-for="DateOfBirth" type="date" class="form-control" id="DateOfBirth" required />
                    <span asp-validation-for="DateOfBirth" class="text-danger"></span>
                </div>
                <div class="form-group">
                    <label asp-for="Age" class="control-label"></label>
                    <input asp-for="Age" class="form-control" readonly id="AgeCalculado" />
                    <span asp-validation-for="Age" class="text-danger"></span>
                </div>
            </div>
            <div class="form-group-row">
                <div class="form-group">
                    <label asp-for="Gender" class="control-label"></label>
                    <select asp-for="Gender" class="form-control form-control-lg" required>
                        <option value="">SELECCIONAR</option>
                        <option value="MASCULINO">MASCULINO</option>
                        <option value="FEMENINO">FEMENINO</option>
                    </select>
                    <span asp-validation-for="Gender" class="text-danger"></span>
                </div>
                <div class="form-group">
                    <label asp-for="CivilStatus" class="control-label"></label>
                    <select asp-for="CivilStatus" class="form-control form-control-lg" required>
                        <option value="">SELECCIONAR</option>
                        <option value="SOLTERO/A">SOLTERO/A</option>
                        <option value="CASADO/A">CASADO/A</option>
                        <option value="DIVORCIADO/A">DIVORCIADO/A</option>
                        <option value="VIUDO/A">VIUDO/A</option>
                    </select>
                    <span asp-validation-for="CivilStatus" class="text-danger"></span>
                </div>
                <div class="form-group">
                    <label asp-for="Phone" class="control-label"></label>
                    <input asp-for="Phone" id="Phone" class="form-control" placeholder="0000-0000" required />
                    <span asp-validation-for="Phone" class="text-danger"></span>
                </div>
                <div class="form-group">
                    <label asp-for="Address" class="control-label"></label>
                    <input asp-for="Address" required class="form-control" placeholder="Residencial - Colonia, Canton - Caserio, Pol. Pasaje - Casa #0" />
                    <span asp-validation-for="Address" class="text-danger"></span>
                </div>
            </div>
            <div class="form-group-row">
                <div class="form-group">
                    <label asp-for="ProfessionOrStudy" class="control-label"></label>
                    <input asp-for="ProfessionOrStudy" class="form-control" placeholder="Ingresar" required />
                    <span asp-validation-for="ProfessionOrStudy" class="text-danger"></span>
                </div>
                <div class="form-group">
                    <label asp-for="PlaceOfWorkOrStudy" class="control-label"></label>
                    <input asp-for="PlaceOfWorkOrStudy" class="form-control" placeholder="Ingresar" required />
                    <span asp-validation-for="PlaceOfWorkOrStudy" class="text-danger"></span>
                </div>
                <div class="form-group">
                    <label asp-for="WorkOrStudyPhone" class="control-label"></label>
                    <input asp-for="WorkOrStudyPhone" id="WorkOrStudyPhone" class="form-control" placeholder="0000-0000" required />
                    <span asp-validation-for="WorkOrStudyPhone" class="text-danger"></span>
                </div>
            </div>
            <br />
            <h3>Información Complementaria</h3>
            <div class="form-group-row">
                <div class="form-group">
                    <label asp-for="ConversionDate" class="control-label"></label>
                    <input asp-for="ConversionDate" type="date" class="form-control" required />
                    <span asp-validation-for="ConversionDate" class="text-danger"></span>
                </div>
                <div class="form-group">
                    <label asp-for="PlaceOfConversion" class="control-label"></label>
                    <input asp-for="PlaceOfConversion" class="form-control" placeholder="Ingresar" required />
                    <span asp-validation-for="PlaceOfConversion" class="text-danger"></span>
                </div>
                <div class="form-group">
                    <label asp-for="WaterBaptism" class="control-label"></label>
                    <select asp-for="WaterBaptism" class="form-control form-control-lg" required>
                        <option value="">SELECCIONAR</option>
                        <option value="SI, DENTRO DE LA MISIÓN">SI, DENTRO DE LA MISIÓN</option>
                        <option value="SI, FUERA DE LA MISIÓN">SI, FUERA DE LA MISIÓN</option>
                    </select>
                    <span asp-validation-for="WaterBaptism" class="text-danger"></span>
                </div>
                <div class="form-group">
                    <label asp-for="BaptismOfTheHolySpirit" class="control-label"></label>
                    <select asp-for="BaptismOfTheHolySpirit" class="form-control form-control-lg" required>
                        <option value="">SELECCIONAR</option>
                        <option value="SI">SI</option>
                        <option value="NO">NO</option>
                    </select>
                    <span asp-validation-for="BaptismOfTheHolySpirit" class="text-danger"></span>
                </div>
            </div>
            <div class="form-group-row">
                <div class="form-group">
                    <label asp-for="PastorsName" class="control-label"></label>
                    <input asp-for="PastorsName" class="form-control" placeholder="Ingresar" required />
                    <span asp-validation-for="PastorsName" class="text-danger"></span>
                </div>
                <div class="form-group">
                    <label asp-for="SupervisorsName" class="control-label"></label>
                    <input asp-for="SupervisorsName" class="form-control" placeholder="Ingresar" />
                    <span asp-validation-for="SupervisorsName" class="text-danger"></span>
                </div>
                <div class="form-group">
                    <label asp-for="LeadersName" class="control-label"></label>
                    <input asp-for="LeadersName" class="form-control" placeholder="Ingresar" />
                    <span asp-validation-for="LeadersName" class="text-danger"></span>
                </div>
            </div>
            <div class="form-group-row">
                <div class="form-group">
                    <label asp-for="TimeToGather" class="control-label"></label>
                    <input asp-for="TimeToGather" class="form-control" placeholder="Ingresar" required />
                    <span asp-validation-for="TimeToGather" class="text-danger"></span>
                </div>
                <div class="form-group">
                    <label asp-for="Zone" class="control-label"></label>
                    <select asp-for="Zone" class="form-control form-control-lg" required>
                        <option value="0">SELECCIONAR</option>
                        <option value="1">ZONA 1</option>
                        <option value="2">ZONA 2</option>
                    </select>
                    <span asp-validation-for="Zone" class="text-danger"></span>
                </div>
                <div class="form-group">
                    <label asp-for="District" class="control-label"></label>
                    <select asp-for="District" class="form-control form-control-lg" required>
                        <option value="0">SELECCIONAR</option>
                        <option value="1">DISTRITO 1</option>
                        <option value="2">DISTRITO 2</option>
                        <option value="3">DISTRITO 3</option>
                    </select>
                    <span asp-validation-for="District" class="text-danger"></span>
                </div>
                <div class="form-group">
                    <label asp-for="Sector" class="control-label"></label>
                    <select asp-for="Sector" class="form-control form-control-lg" required>
                        <option value="0">SELECCIONAR</option>
                        <option value="1">SECTOR 1</option>
                        <option value="2">SECTOR 2</option>
                        <option value="3">SECTOR 3</option>
                    </select>
                </div>
                <div class="form-group">
                    <label asp-for="Cell" class="control-label"></label>
                    <select asp-for="Cell" class="form-control form-control-lg" required>
                        <option value="0">SELECCIONAR</option>
                        <option value="1">CELULA 1</option>
                        <option value="2">CELULA 2</option>
                        <option value="3">CELULA 3</option>
                        <option value="4">CELULA 4</option>
                        <option value="5">CELULA 5</option>
                    </select>
                </div>
            </div>
            <br />
            <h3>Información Adicional</h3>
            <div class="form-group-row">
                <div class="form-group">
                    <label asp-for="InternalIdentityCode" class="control-label"></label>
                    <input asp-for="InternalIdentityCode" id="InternalIdentityCode" class="form-control" readonly />
                    <span asp-validation-for="InternalIdentityCode" class="text-danger"></span>
                </div>
                <div class="form-group">
                    <label asp-for="Status" class="control-label"></label>
                    <select asp-for="Status" class="form-control form-control-lg" required>
                        <option value="">SELECCIONAR</option>
                        <option selected value="1">ACTIVO</option>
                        <option value="2">INACTIVO</option>
                    </select>
                    <span asp-validation-for="Status" class="text-danger"></span>
                </div>
                <div class="form-group">
                    <label asp-for="ImageData" class="control-label"></label>
                    <input type="file" class="form-control" id="imagen" name="imagen" onchange="mostrarImagen()" asp-for="ImageData" required />
                    <span asp-validation-for="ImageData" class="text-danger"></span>
                </div>
            </div>
            <div class="form-group-row">
                <div class="form-group">
                    <label asp-for="CommentsOrObservations" class="control-label"></label>
                    <input asp-for="CommentsOrObservations" class="form-control" placeholder="Opcional" />
                </div>
            </div>
            <div class="form-group-row">
                <div class="form-group">
                    <label asp-for="DateCreated" class="control-label"></label>
                    <input asp-for="DateCreated" type="date" class="form-control" readonly />
                </div>
                <div class="form-group">
                    <label asp-for="DateModification" class="control-label"></label>
                    <input asp-for="DateModification" type="date" class="form-control" readonly />
                </div>
            </div>
            <br />
            <div>
                <p><strong>Vista previa de la Fotografia:</strong></p>
                @if (ViewBag.ImageUrl != null)
                {
                    <img src="data:image/jpeg;base64,@ViewBag.ImageUrl" alt="Imagen de miembro" class="img-thumbnail" width="150" />
                }
            </div>
            <br />
            <div>
                <a class="btn btn-outline-secondary" asp-action="Index">Regresar a La Lista</a> |
                <input type="submit" value="Modificar Membresia" class="btn btn-primary" />
            </div>
        </form>
    </div>
</div>
<br />

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }

    <script>
        // Configuracion de Alerta
        function showErrorAlert(message) {
            Swal.fire({
                title: 'Error',
                text: message,
                icon: 'error'
            });
        }
        // Mostrar alerta de ViewBag.Error si es necesario
        @if (!string.IsNullOrEmpty(ViewBag.Error))
        {
            @:showErrorAlert('@ViewBag.Error');
        }

        // Función para automatizar el campo de DUI
        document.getElementById("Dui").addEventListener("input", function (event) {
            let duiValue = event.target.value.replace(/\D/g, ''); // Eliminar cualquier caracter no numérico
            let formattedDui = '';

            if (duiValue.length >= 9) {
                formattedDui = duiValue.slice(0, 8) + '-' + duiValue.slice(8, 9);
            } else {
                formattedDui = duiValue;
            }

            event.target.value = formattedDui;
        });

        // Calcular edad en tiempo real
        document.getElementById("DateOfBirth").addEventListener("change", function () {
            let dob = new Date(this.value);
            let today = new Date();
            let age = today.getFullYear() - dob.getFullYear();
            let m = today.getMonth() - dob.getMonth();
            if (m < 0 || (m === 0 && today.getDate() < dob.getDate())) {
                age--;
            }
            document.getElementById("AgeCalculado").value = age;
        });

        // Formato de teléfono y trabajo
        function formatPhone(input) {
            input.addEventListener("input", function (event) {
                let phone = event.target.value.replace(/\D/g, ''); // Solo números
                if (phone.length > 4) phone = phone.substring(0, 4) + '-' + phone.substring(4, 8);
                event.target.value = phone;
            });
        }
        formatPhone(document.getElementById("Phone"));
        formatPhone(document.getElementById("WorkOrStudyPhone"));

        // Generar Código de Identidad Interna
        document.getElementById("Name").addEventListener("input", generateInternalCode);
        document.getElementById("LastName").addEventListener("input", generateInternalCode);
        document.getElementById("DateOfBirth").addEventListener("change", generateInternalCode);

        function generateInternalCode() {
            let name = document.getElementById("Name").value.trim().toLowerCase();
            let lastName = document.getElementById("LastName").value.trim().toLowerCase();
            let dob = document.getElementById("DateOfBirth").value;

            if (name && lastName && dob) {
                let nameParts = name.split(' ');
                let lastNameParts = lastName.split(' ');
                let year = dob.split('-')[0];

                let code = nameParts[0][0] + (nameParts[1] ? nameParts[1][0] : '') + (nameParts[2] ? nameParts[2][0] : '') +
                    lastNameParts[0][0] + (lastNameParts[1] ? lastNameParts[1][0] : '') + (lastNameParts[2] ? lastNameParts[2][0] : '') +
                    year;
                document.getElementById("InternalIdentityCode").value = code;
            }
        }

        // Mostrar imagen en vista previa
        function mostrarImagen() {
            let input = document.getElementById("imagen");
            let preview = document.getElementById("imagenPreview");

            let reader = new FileReader();
            reader.onload = function (e) {
                preview.src = e.target.result;
                preview.style.display = "block";
            };
            reader.readAsDataURL(input.files[0]);
        }

        // Función para manejar el evento de envío de formulario
        function CreateRecord(e) {
            e.preventDefault(); // Prevenir el envío del formulario

            const form = document.getElementById('Form');

            Swal.fire({
                title: '¿Modificar Membresia?',
                icon: 'question',
                showCancelButton: true,
                confirmButtonText: 'Sí, Modificar Membresia',
                cancelButtonText: 'Cancelar',
                reverseButtons: true
            }).then((result) => {
                if (result.isConfirmed) {
                    form.submit(); // Enviar el formulario si se confirma la acción
                }
            });
        }

        // Añadir evento de envío al formulario
        const form = document.getElementById('Form');
        if (form) {
            form.addEventListener('submit', CreateRecord);
        }
    </script>
}